<!doctype html>
<html>
  <head>
    <title>bde-graph demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

    <link rel="import" href="../../polymer/polymer.html">
    <link rel="import" href="../bde-graph.html">

    <style is="custom-style">
      body {
        margin: 0;
        height: 100vh;
      }

      #debug {
        position: absolute;
        top: 20px;
        right: 20px;
      }
    </style>
  </head>
  <body>

    <template is="dom-bind" id="app">
      <bde-graph id="graph"></bde-graph>

      <div id="debug">
        <input is="iron-input" type="text" bind-value="{{webpackageUrl}}">
        <button on-tap="fetchWebpackage">Load</button>
      </div>
    </template>

    <script>
    (function() {
      "use strict";    

      var app = document.querySelector('#app');

      app.fetchWebpackage = function() {
        var url = app.webpackageUrl;
        if (!url.endsWith('/manifest.webpackage')) {
          url += '/manifest.webpackage';
        }

        fetch(url).then(res => res.json())
          .then(webpackage => {
            console.log(webpackage);
          });
      }


      app.addEventListener('dom-change', function() {
        this.$.graph.artifactId = 'test-compound';

        fetch('demo.json').then(r => r.json())
          .then(demo => {
            demo.components.forEach(
              definition => this.$.graph.registerComponent(definition)
            );
            this.$.graph.push('members', ...demo.members);
            this.$.graph.push('slots', ...demo.slots);
            this.$.graph.push('connections', ...demo.connections);
            this.$.graph.push('inits', ...demo.inits);

            // Autolayout
            // TheGraph library is not immediatly available...
            // @todo: (fdu) This failes after adding inports
            // requestAnimationFrame(() => this.$.graph.triggerAutolayout());
            ;
          });
      });
    })();
    </script>
  </body>
</html>
